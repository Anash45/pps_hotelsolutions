import{r as o,b as E,j as e,c as w,I as d,T as x,a as m,D as H,S as T,e as S,P as F,h as A,i as L,k as M,l as B,H as K}from"./app--n2fMqHU.js";import{G as I}from"./GuestBox-C57zFQNS.js";import{H as v}from"./HotelKeyFinder-BtopuBHL.js";import{H as k}from"./HotelLanding-Ioy1mBna.js";import{F as P}from"./FlashMessage-C4u4M1Vu.js";import{G as V}from"./GuestKeyLayout-P83C_esq.js";import{m as z}from"./mapHotelToBrandingFormData-BFWpowZZ.js";function G(){const[i,f]=o.useState(!1);if(E("Components.userSelfEdit"),i)return e.jsx(D,{});const{codeDetails:s}=w().props,[t,g]=o.useState({}),[r,y]=o.useState(""),[c,N]=o.useState(!0),[j,h]=o.useState(!1),[a,_]=o.useState({salutation:"",title:"",first_name:"",last_name:"",room_number:"",phone_number:"",email:"",stay_from:"",stay_till:"",gdpr_consent:c,code_id:s?.code??null}),l=p=>{const{name:n,value:u}=p.target;_(C=>({...C,[n]:u}))},b=async p=>{p.preventDefault(),g({}),y(""),h(!0);try{const n=await A.post(route("keyassignment.userStore"),a);n.data.success?(h(!1),y(n.data.message),setTimeout(()=>window.location.reload(),2e3)):(h(!1),g({general:[n.data.message]}))}catch(n){if(h(!1),n.response?.status===422){const u=n.response.data;g(u.errors||{general:[u.message]})}else g({general:["Something went wrong."]})}};return e.jsxs("form",{onSubmit:b,className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h2",{className:"text-lg text-[#201A20] font-semibold",children:"Register Key Finder"}),e.jsx("p",{className:"text-xs font-medium text-[#475569]",children:"Setup key finder"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{htmlFor:"stay_from",value:"Stay from",className:"text-[#475569] text-xs font-medium"}),e.jsx(x,{id:"stay_from",name:"stay_from",value:a.stay_from,onChange:l,type:"date",className:"date-inp block w-full",placeholder:"dd.mm.yyyy"}),e.jsx(m,{message:t.stay_from})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{htmlFor:"stay_till",value:"Stay till",className:"text-[#475569] text-xs font-medium"}),e.jsx(x,{id:"stay_till",name:"stay_till",value:a.stay_till,onChange:l,type:"date",className:"date-inp block w-full",placeholder:"dd.mm.yyyy"}),e.jsx(m,{message:t.stay_till})]})]}),e.jsx(H,{}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[c&&e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{htmlFor:"salutation",value:"Salutation",className:"text-[#475569] text-xs font-medium"}),e.jsx(T,{id:"salutation",name:"salutation",value:a.salutation,onChange:l,className:"w-full block",options:[{value:"Mr",label:"Mr."},{value:"Mrs",label:"Mrs."},{value:"Ms",label:"Ms."}]}),e.jsx(m,{message:t.salutation})]}),c&&e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{htmlFor:"title",value:"Title",className:"text-[#475569] text-xs font-medium"}),e.jsx(x,{id:"title",name:"title",value:a.title,onChange:l,type:"text",className:"block w-full",placeholder:"e.g. Dr."}),e.jsx(m,{message:t.title})]}),c&&e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{htmlFor:"first_name",value:"First Name",className:"text-[#475569] text-xs font-medium"}),e.jsx(x,{id:"first_name",name:"first_name",value:a.first_name,onChange:l,type:"text",className:"block w-full",placeholder:"e.g. John"}),e.jsx(m,{message:t.first_name})]}),c&&e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{htmlFor:"last_name",value:"Last Name",className:"text-[#475569] text-xs font-medium"}),e.jsx(x,{id:"last_name",name:"last_name",value:a.last_name,onChange:l,type:"text",className:"block w-full",placeholder:"e.g. Doe"}),e.jsx(m,{message:t.last_name})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{htmlFor:"room_number",value:"Room Number",className:"text-[#475569] text-xs font-medium"}),e.jsx(x,{id:"room_number",name:"room_number",value:a.room_number,onChange:l,type:"text",className:"block w-full",placeholder:"e.g. 321"}),e.jsx(m,{message:t.room_number})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"phone_number",value:"Mobile Phone Number (for Key Finder only)",className:"text-[#475569] text-xs font-medium"}),e.jsx(x,{id:"phone_number",name:"phone_number",value:a.phone_number,onChange:l,type:"tel",className:"block w-full",placeholder:"e.g. +49 123 456789"}),e.jsx(m,{message:t.phone_number})]}),c&&e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{htmlFor:"email",value:"Email Address",className:"text-[#475569] text-xs font-medium"}),e.jsx(x,{id:"email",name:"email",value:a.email,onChange:l,type:"email",className:"block w-full",placeholder:"e.g. example@xyz.com"}),e.jsx(m,{message:t.email})]})]})]}),e.jsx(P,{message:r}),e.jsxs("div",{className:"flex items-center gap-2 justify-end flex-wrap",children:[e.jsxs("div",{className:"flex gap-2",children:[j&&e.jsx("p",{className:"text-sm",children:"Loading..."}),Object.keys(t).length>0&&e.jsx(m,{message:t?.general??"Fix the errors in the form."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(S,{type:"button",onClick:()=>window.location.reload(),children:"Cancel"}),e.jsx(F,{disabled:j,type:"submit",children:"Save"})]})]})]})}function D(){const{codeDetails:i,flash:f}=w().props,[s,t]=o.useState(!1),r=L()?.isDE||null,y=()=>{confirm(r?"Sind Sie sicher? Diese Handlung kann nicht rückgängig gemacht werden.":"Are you sure? This action cannot be undone.")&&M.get(route("key.makeActive",{code:i.code}))},c=()=>{t(!0)};return s?e.jsx(G,{}):e.jsxs("div",{className:"space-y-4 text-center sm:px-7 py-4 text-base",children:[e.jsx("div",{className:"h-[120px] w-[120px] flex items-center justify-center mx-auto rounded-full border-light border",children:e.jsx("img",{src:"/images/keytag.png",alt:"Key",className:"h-16 w-16"})}),e.jsx("p",{children:r?"Dieser Keytag kann nach Ihrem Aufenthalt als Schlüsselfinder dienen.":"This Keytag can serve as a key finder after your stay."}),e.jsx("p",{children:r?e.jsxs(e.Fragment,{children:["Um dies zu ermöglichen, müssen Sie im nächsten Dialog Ihre Mobilnummer sowie weitere Angaben eingeben, damit ein Finder"," ",e.jsx("span",{className:"font-bold",children:"Sie kontaktieren"})," ","kann."]}):e.jsxs(e.Fragment,{children:["To do so, you must enter your mobile number along with other details in the next dialog so that a finder can"," ",e.jsx("span",{className:"font-bold",children:"contact you"}),"."]})}),e.jsx("p",{children:r?"Möchten Sie die Schlüsselsuchfunktion nutzen?":"Would you like to use the key finder function?"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(F,{onClick:c,children:r?"Ja":"Yes"}),e.jsx(S,{onClick:y,children:r?"Nein":"No"})]})]})}function R(){console.log("[1] Component started");const{selectedHotel:i=null,codeDetails:f}=w().props;console.log("[2] Props loaded:",{selectedHotel:i,codeDetails:f});const{brandingFormData:s,setBrandingFormData:t,loadingButton:g}=o.useContext(B),[r,y]=o.useState(!1),{url:c}=w();console.log("[3] State initialized"),o.useEffect(()=>{console.log("[4] First useEffect - hotel branding"),i&&t(z(i,{user_view:!0}))},[i,c]);const N=f?.key_assignment,j=f?.key_type?.name,h=N?.stay_till,a=h?new Date(h):null,_=new Date,l=a!==null&&a<_,b=f?.status,p=N?.phone_number?.trim();console.log("[5] Variables:",{keyTypeName:j,status:b,isExpired:l,phoneNumber:p});let n=k,u=!1;return j==="key_finder"?(console.log("[6] Key finder logic entered"),b==="inactive"?(console.log("[7] -> AskDetails (inactive)"),n=D,u=!0):a&&a>_||!p?(console.log("[7] -> HotelLanding (not expired or no phone)"),n=k):b==="active"&&p&&l&&(console.log("[7] -> HotelKeyFinder (active + expired)"),n=v)):console.log("[6] Not key_finder, default to HotelLanding"),o.useEffect(()=>{console.log("[8] Second useEffect - defaultView"),u&&(console.log("[9] Setting defaultView to true"),y(!0))},[u]),console.log("[10] Rendering with:",n.name),e.jsxs(e.Fragment,{children:[e.jsxs(K,{children:[e.jsx("title",{children:s?.heading??"Hotel"}),e.jsx("link",{rel:"icon",type:"image/png",href:s?.logo_image_url??s?.banner_image_url??"/images/building-placeholder.webp"}),e.jsx("meta",{property:"og:title",content:s?.heading??"Hotel"}),e.jsx("meta",{property:"og:description",content:s?.meta_description??s?.description??"Book your perfect stay with us!"}),e.jsx("meta",{property:"og:image",content:s?.logo_image_url??"/images/building-placeholder.webp"}),e.jsx("meta",{property:"og:type",content:"website"}),e.jsx("meta",{property:"og:url",content:typeof window<"u"?window.location.href:""}),e.jsx("meta",{name:"twitter:card",content:"summary_large_image"}),e.jsx("meta",{name:"twitter:title",content:s?.heading??"Hotel"}),e.jsx("meta",{name:"twitter:description",content:s?.meta_description??s?.description??"Book your perfect stay with us!"}),e.jsx("meta",{name:"twitter:image",content:s?.logo_image_url??"/images/building-placeholder.webp"})]}),e.jsx(I,{realPhone:!0,defaultView:r,showNextBox:n===v,children:e.jsx(n,{})}),g&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-70 z-50",children:e.jsx("div",{className:"loader border-t-transparent border-4 border-[#b6ffb5] rounded-full w-10 h-10 animate-spin"})})]})}R.layout=i=>e.jsx(e.Fragment,{children:e.jsx(V,{children:i})});export{R as default};
