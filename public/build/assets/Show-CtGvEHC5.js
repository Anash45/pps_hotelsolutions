import{r as n,j as e,b as v,I as c,T as p,a as r,D,S as E,d as k,P as S,f as H,h as T,i as B,H as L}from"./app-CQY5pZ1q.js";import{G as M}from"./GuestBox-AJMgiK3i.js";import{H as A}from"./HotelKeyFinder-DLgGBgQj.js";import{H as w}from"./HotelLanding-Bmb4-vER.js";import{F as P}from"./FlashMessage-BciMiYex.js";import{G as $}from"./GuestKeyLayout-B2JjdQAV.js";import{m as G}from"./mapHotelToBrandingFormData-CLw-jNZI.js";function I(){const[i,f]=n.useState(!1);if(i)return e.jsx(F,{});const{codeDetails:l}=v().props,[t,d]=n.useState({}),[g,b]=n.useState(""),[u,N]=n.useState(!0),[y,x]=n.useState(!1),[a,_]=n.useState({salutation:"",title:"",first_name:"",last_name:"",room_number:"",phone_number:"",email:"",stay_from:"",stay_till:"",gdpr_consent:u,code_id:l?.code??null}),o=h=>{const{name:s,value:m}=h.target;_(C=>({...C,[s]:m}))},j=async h=>{h.preventDefault(),d({}),b(""),x(!0);try{const s=await H.post(route("keyassignment.userStore"),a);s.data.success?(x(!1),console.log("✅ Saved:",s.data.message),b(s.data.message),setTimeout(()=>{window.location.reload()},2e3)):(x(!1),console.log("⚠️ Error:",s.data.message),d({general:[s.data.message]}))}catch(s){if(x(!1),s.response?.status===422){const m=s.response.data;console.log("⚠️ Validation failed:",m),d(m.errors||{general:[m.message]})}else console.error("Unexpected error:",s),d({general:["Something went wrong."]})}};return console.log(t),e.jsxs("form",{onSubmit:j,className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h2",{className:"text-lg text-[#201A20] font-semibold",children:"Register Key Finder"}),e.jsx("p",{className:"text-xs font-medium text-[#475569]",children:"Setup key finder"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{htmlFor:"stay_from",value:"Stay from",className:"text-[#475569] text-xs font-medium"}),e.jsx(p,{id:"stay_from",name:"stay_from",value:a.stay_from,onChange:o,type:"date",className:"date-inp block w-full",placeholder:"dd.mm.yyyy"}),e.jsx(r,{message:t.stay_from})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{htmlFor:"stay_till",value:"Stay till",className:"text-[#475569] text-xs font-medium"}),e.jsx(p,{id:"stay_till",name:"stay_till",value:a.stay_till,onChange:o,type:"date",className:"date-inp block w-full",placeholder:"dd.mm.yyyy"}),e.jsx(r,{message:t.stay_till})]})]}),e.jsx(D,{}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsxs("div",{className:`space-y-1 ${u?"block":"hidden"}`,children:[e.jsx(c,{htmlFor:"salutation",value:"Salutation",className:"text-[#475569] text-xs font-medium"}),e.jsx(E,{id:"salutation",name:"salutation",value:a.salutation,onChange:o,className:"w-full block",options:[{value:"Mr",label:"Mr."},{value:"Mrs",label:"Mrs."},{value:"Ms",label:"Ms."}]}),e.jsx(r,{message:t.salutation})]}),e.jsxs("div",{className:`space-y-1 ${u?"block":"hidden"}`,children:[e.jsx(c,{htmlFor:"title",value:"Title",className:"text-[#475569] text-xs font-medium"}),e.jsx(p,{id:"title",name:"title",value:a.title,onChange:o,type:"text",className:"block w-full",placeholder:"e.g. Dr."}),e.jsx(r,{message:t.title})]}),e.jsxs("div",{className:`space-y-1 ${u?"block":"hidden"}`,children:[e.jsx(c,{htmlFor:"first_name",value:"First Name",className:"text-[#475569] text-xs font-medium"}),e.jsx(p,{id:"first_name",name:"first_name",value:a.first_name,onChange:o,type:"text",className:"block w-full",placeholder:"First name"}),e.jsx(r,{message:t.first_name})]}),e.jsxs("div",{className:`space-y-1 ${u?"block":"hidden"}`,children:[e.jsx(c,{htmlFor:"last_name",value:"Last Name",className:"text-[#475569] text-xs font-medium"}),e.jsx(p,{id:"last_name",name:"last_name",value:a.last_name,onChange:o,type:"text",className:"block w-full",placeholder:"Last name"}),e.jsx(r,{message:t.last_name})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{htmlFor:"room_number",value:"Room Number",className:"text-[#475569] text-xs font-medium"}),e.jsx(p,{id:"room_number",name:"room_number",value:a.room_number,onChange:o,type:"text",className:"block w-full",placeholder:"Room #"}),e.jsx(r,{message:t.room_number})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"phone_number",value:"Mobile Phone Number (for Key finder only)",className:"text-[#475569] text-xs font-medium"}),e.jsx(p,{id:"phone_number",name:"phone_number",value:a.phone_number,onChange:o,type:"tel",className:"block w-full",placeholder:"+49 123 456789"}),e.jsx(r,{message:t.phone_number})]}),e.jsxs("div",{className:`space-y-1 ${u?"block":"hidden"}`,children:[e.jsx(c,{htmlFor:"email",value:"Email Address",className:"text-[#475569] text-xs font-medium"}),e.jsx(p,{id:"email",name:"email",value:a.email,onChange:o,type:"email",className:"block w-full",placeholder:"example@email.com"}),e.jsx(r,{message:t.email})]})]})]}),e.jsx(P,{message:g}),e.jsxs("div",{className:"flex items-center gap-2 justify-end flex-wrap",children:[y?e.jsx("p",{className:"text-sm",children:"Loading..."}):"",Object.keys(t).length>0&&e.jsx(r,{message:`${t?.general??"Fix the errors in the form."}`}),e.jsx(k,{onClick:()=>f(!0),children:"Cancel"}),e.jsx(S,{disabled:y,type:"submit",children:"Save"})]})]})}function F(){const{codeDetails:i,flash:f}=v().props,[l,t]=n.useState(!1),d=()=>{T.get(route("key.makeActive",{code:i.code}))},g=()=>{t(!0)};return l?e.jsx(I,{}):e.jsxs("div",{className:"space-y-4 text-center sm:px-7 py-4 text-base",children:[e.jsx("div",{className:"h-[120px] w-[120px] flex items-center justify-center mx-auto rounded-full border-light border",children:e.jsx("img",{src:"/images/key_icon.svg",alt:"Key",className:"h-16 w-16"})}),e.jsx("p",{children:"This key can serve as a key finder after your stay."}),e.jsxs("p",{children:["To do so you must enter your mobile number along with other details in next dialog so that a finder can"," ",e.jsx("span",{className:"font-bold",children:"contact you"}),"."]}),e.jsx("p",{children:"Would you like to use the key finder function?"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(S,{onClick:g,children:"Yes"}),e.jsx(k,{onClick:d,children:"No"})]})]})}function K(){const{selectedHotel:i=null,codeDetails:f}=v().props,{brandingFormData:l,setBrandingFormData:t,loadingButton:d}=n.useContext(B),[g,b]=n.useState(!1),{url:u}=v();n.useEffect(()=>{i&&t(G(i,{user_view:!0}))},[i,u]);const N=f?.key_assignment,y=f?.key_type?.name,x=N?.stay_till,a=x?new Date(x):null,_=new Date,o=a!==null&&a<_,j=f?.status,h=N?.phone_number?.trim();console.log("Data:",{keyTypeName:y,status:j,phoneNumber:h,stayTillRaw:x,isExpired:o});let s=w,m=!1;return y==="key_finder"&&(j==="inactive"?(s=F,m=!0,console.log("1")):h?a&&a>_?(s=w,console.log("3")):j==="active"&&h&&o&&(s=A,console.log("4")):(s=w,console.log("2"))),n.useEffect(()=>{m&&b(!0)},[m]),e.jsxs(e.Fragment,{children:[e.jsxs(L,{children:[e.jsx("title",{children:l?.heading??"Hotel"}),e.jsx("link",{rel:"icon",type:"image/png",href:l?.logo_image_url??"/images/building-placeholder.webp"}),e.jsx("meta",{property:"og:title",content:l?.heading??"Hotel"}),e.jsx("meta",{property:"og:description",content:l?.meta_description??l?.description??"Book your perfect stay with us!"}),e.jsx("meta",{property:"og:image",content:l?.logo_image_url??"/images/building-placeholder.webp"}),e.jsx("meta",{property:"og:type",content:"website"}),e.jsx("meta",{property:"og:url",content:typeof window<"u"?window.location.href:""}),e.jsx("meta",{name:"twitter:card",content:"summary_large_image"}),e.jsx("meta",{name:"twitter:title",content:l?.heading??"Hotel"}),e.jsx("meta",{name:"twitter:description",content:l?.meta_description??l?.description??"Book your perfect stay with us!"}),e.jsx("meta",{name:"twitter:image",content:l?.logo_image_url??"/images/building-placeholder.webp"})]}),e.jsx(M,{realPhone:!0,defaultView:g,children:e.jsx(s,{})}),d&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-70 z-50",children:e.jsx("div",{className:"loader border-t-transparent border-4 border-[#b6ffb5] rounded-full w-10 h-10 animate-spin"})})]})}K.layout=i=>e.jsx(e.Fragment,{children:e.jsx($,{children:i})});export{K as default};
