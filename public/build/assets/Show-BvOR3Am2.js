import{r as m,j as e,b as k,I as c,T as u,a as i,D,S as E,d as w,P as S,e as T,f as L,h as M,H as $}from"./app-C2XvruTL.js";import{G as A}from"./GuestBox-CIPuv_k-.js";import{H as N,a as H}from"./HotelLanding-ECQ27sHz.js";import{F as P}from"./FlashMessage-BdBPhXcK.js";import{G}from"./GuestKeyLayout-ByNkCYWF.js";function I(){const[h,s]=m.useState(!1);if(h)return e.jsx(F,{});const{codeDetails:x}=k().props,[t,d]=m.useState({}),[g,p]=m.useState(""),[r,_]=m.useState(!0),[y,f]=m.useState(!1),[o,j]=m.useState({salutation:"",title:"",first_name:"",last_name:"",room_number:"",phone_number:"",email:"",stay_from:"",stay_till:"",gdpr_consent:r,code_id:x?.code??null}),l=a=>{const{name:n,value:b}=a.target;j(C=>({...C,[n]:b}))},v=async a=>{a.preventDefault(),d({}),p(""),f(!0);try{const n=await T.post(route("keyassignment.userStore"),o);n.data.success?(f(!1),console.log("✅ Saved:",n.data.message),p(n.data.message),setTimeout(()=>{window.location.reload()},2e3)):(f(!1),console.log("⚠️ Error:",n.data.message),d({general:[n.data.message]}))}catch(n){if(f(!1),n.response?.status===422){const b=n.response.data;console.log("⚠️ Validation failed:",b),d(b.errors||{general:[b.message]})}else console.error("Unexpected error:",n),d({general:["Something went wrong."]})}};return console.log(t),e.jsxs("form",{onSubmit:v,className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h2",{className:"text-lg text-[#201A20] font-semibold",children:"Register Key Finder"}),e.jsx("p",{className:"text-xs font-medium text-[#475569]",children:"Setup key finder"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{htmlFor:"stay_from",value:"Stay from",className:"text-[#475569] text-xs font-medium"}),e.jsx(u,{id:"stay_from",name:"stay_from",value:o.stay_from,onChange:l,type:"date",className:"date-inp block w-full",placeholder:"dd.mm.yyyy"}),e.jsx(i,{message:t.stay_from})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{htmlFor:"stay_till",value:"Stay till",className:"text-[#475569] text-xs font-medium"}),e.jsx(u,{id:"stay_till",name:"stay_till",value:o.stay_till,onChange:l,type:"date",className:"date-inp block w-full",placeholder:"dd.mm.yyyy"}),e.jsx(i,{message:t.stay_till})]})]}),e.jsx(D,{}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsxs("div",{className:`space-y-1 ${r?"block":"hidden"}`,children:[e.jsx(c,{htmlFor:"salutation",value:"Salutation",className:"text-[#475569] text-xs font-medium"}),e.jsx(E,{id:"salutation",name:"salutation",value:o.salutation,onChange:l,className:"w-full block",options:[{value:"Mr",label:"Mr."},{value:"Mrs",label:"Mrs."},{value:"Ms",label:"Ms."}]}),e.jsx(i,{message:t.salutation})]}),e.jsxs("div",{className:`space-y-1 ${r?"block":"hidden"}`,children:[e.jsx(c,{htmlFor:"title",value:"Title",className:"text-[#475569] text-xs font-medium"}),e.jsx(u,{id:"title",name:"title",value:o.title,onChange:l,type:"text",className:"block w-full",placeholder:"e.g. Dr."}),e.jsx(i,{message:t.title})]}),e.jsxs("div",{className:`space-y-1 ${r?"block":"hidden"}`,children:[e.jsx(c,{htmlFor:"first_name",value:"First Name",className:"text-[#475569] text-xs font-medium"}),e.jsx(u,{id:"first_name",name:"first_name",value:o.first_name,onChange:l,type:"text",className:"block w-full",placeholder:"First name"}),e.jsx(i,{message:t.first_name})]}),e.jsxs("div",{className:`space-y-1 ${r?"block":"hidden"}`,children:[e.jsx(c,{htmlFor:"last_name",value:"Last Name",className:"text-[#475569] text-xs font-medium"}),e.jsx(u,{id:"last_name",name:"last_name",value:o.last_name,onChange:l,type:"text",className:"block w-full",placeholder:"Last name"}),e.jsx(i,{message:t.last_name})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{htmlFor:"room_number",value:"Room Number",className:"text-[#475569] text-xs font-medium"}),e.jsx(u,{id:"room_number",name:"room_number",value:o.room_number,onChange:l,type:"text",className:"block w-full",placeholder:"Room #"}),e.jsx(i,{message:t.room_number})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"phone_number",value:"Mobile Phone Number (for Key finder only)",className:"text-[#475569] text-xs font-medium"}),e.jsx(u,{id:"phone_number",name:"phone_number",value:o.phone_number,onChange:l,type:"tel",className:"block w-full",placeholder:"+49 123 456789"}),e.jsx(i,{message:t.phone_number})]}),e.jsxs("div",{className:`space-y-1 ${r?"block":"hidden"}`,children:[e.jsx(c,{htmlFor:"email",value:"Email Address",className:"text-[#475569] text-xs font-medium"}),e.jsx(u,{id:"email",name:"email",value:o.email,onChange:l,type:"email",className:"block w-full",placeholder:"example@email.com"}),e.jsx(i,{message:t.email})]})]})]}),e.jsx(P,{message:g}),e.jsxs("div",{className:"flex items-center gap-2 justify-end flex-wrap",children:[y?e.jsx("p",{className:"text-sm",children:"Loading..."}):"",Object.keys(t).length>0&&e.jsx(i,{message:`${t?.general??"Fix the errors in the form."}`}),e.jsx(w,{onClick:()=>s(!0),children:"Cancel"}),e.jsx(S,{disabled:y,type:"submit",children:"Save"})]})]})}function F(){const{codeDetails:h,flash:s}=k().props,[x,t]=m.useState(!1),d=()=>{L.get(route("key.makeActive",{code:h.code}))},g=()=>{t(!0)};return x?e.jsx(I,{}):e.jsxs("div",{className:"space-y-4 text-center sm:px-7 py-4 text-base",children:[e.jsx("div",{className:"h-[120px] w-[120px] flex items-center justify-center mx-auto rounded-full border-light border",children:e.jsx("img",{src:"/images/key_icon.svg",alt:"Key",className:"h-16 w-16"})}),e.jsx("p",{children:"This key can serve as a key finder after your stay."}),e.jsxs("p",{children:["To do so you must enter your mobile number along with other details in next dialog so that a finder can"," ",e.jsx("span",{className:"font-bold",children:"contact you"}),"."]}),e.jsx("p",{children:"Would you like to use the key finder function?"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(S,{onClick:g,children:"Yes"}),e.jsx(w,{onClick:d,children:"No"})]})]})}function K({code:h}){const{selectedHotel:s=null,codeDetails:x}=k().props,{brandingFormData:t,setBrandingFormData:d}=m.useContext(M);m.useEffect(()=>{s&&d(v=>({...v,heading:s.heading||"",primary_color:s.primary_color||"#000000",background_color:s.background_color||"#c1c1c1",text_color:s.text_color||"#1b1b1b",button_text_color:s.button_text_color||"#ffffff",logo_image:null,logo_image_url:s.logo_image?`/storage/${s.logo_image}`:null,banner_image:null,banner_image_url:s.banner_image?`/storage/${s.banner_image}`:null,key_finder_page_text:s.key_finder_page_text||"",page_text_color:s.page_text_color||"#000000",pages:s?.pages,buttons:(s?.buttons||[]).map(a=>({button_id:a.id??null,hotel_id:a.hotel_id??s.id,type:a.type||"",text:a.text||"",icon:a.icon||"",order:a.order??0,text_color:a.text_color||"#ffffff",background_color:a.background_color||"#84af83",url:a.url||"",phone:a.phone||"",wifi_name:a.wifi_name||"",wifi_password:a.wifi_password||"",page_id:a.page_id??null}))}))},[s]);const g=x?.key_assignment,p=x?.key_type?.name,r=g?.stay_till,_=r?new Date(r):null,y=new Date,f=_!==null&&_<y,o=x?.status,j=g?.phone_number?.trim();console.log("Data:",{keyTypeName:p,status:o,phoneNumber:j,stayTillRaw:r,isExpired:f});let l=N;return p==="key_finder"&&(o==="inactive"?(l=F,console.log("1")):j?_&&_>y?(l=N,console.log("3")):o==="active"&&j&&f&&(l=H,console.log("4")):(l=N,console.log("2"))),e.jsxs(e.Fragment,{children:[e.jsx($,{title:t?.heading??"Hotel"}),e.jsx(A,{realPhone:!0,children:e.jsx(l,{})})]})}K.layout=h=>e.jsx(G,{children:h});export{K as default};
