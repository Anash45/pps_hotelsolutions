import{r,j as e,b as N,I as u,T as f,a as i,D,S as E,d as S,P as F,e as T,f as H,h as L,H as M}from"./app-BIfnRM97.js";import{G as $}from"./GuestBox-BbGoN48X.js";import{H as A}from"./HotelKeyFinder-HLoS1g7r.js";import{H as w}from"./HotelLanding-BdDNQiKH.js";import{F as P}from"./FlashMessage-Dc9pIocX.js";import{G}from"./GuestKeyLayout-Bi-ALoMp.js";function I(){const[s,g]=r.useState(!1);if(s)return e.jsx(C,{});const{codeDetails:_}=N().props,[a,x]=r.useState({}),[y,b]=r.useState(""),[c,k]=r.useState(!0),[p,m]=r.useState(!1),[o,v]=r.useState({salutation:"",title:"",first_name:"",last_name:"",room_number:"",phone_number:"",email:"",stay_from:"",stay_till:"",gdpr_consent:c,code_id:_?.code??null}),n=d=>{const{name:t,value:h}=d.target;v(l=>({...l,[t]:h}))},j=async d=>{d.preventDefault(),x({}),b(""),m(!0);try{const t=await T.post(route("keyassignment.userStore"),o);t.data.success?(m(!1),console.log("✅ Saved:",t.data.message),b(t.data.message),setTimeout(()=>{window.location.reload()},2e3)):(m(!1),console.log("⚠️ Error:",t.data.message),x({general:[t.data.message]}))}catch(t){if(m(!1),t.response?.status===422){const h=t.response.data;console.log("⚠️ Validation failed:",h),x(h.errors||{general:[h.message]})}else console.error("Unexpected error:",t),x({general:["Something went wrong."]})}};return console.log(a),e.jsxs("form",{onSubmit:j,className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h2",{className:"text-lg text-[#201A20] font-semibold",children:"Register Key Finder"}),e.jsx("p",{className:"text-xs font-medium text-[#475569]",children:"Setup key finder"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(u,{htmlFor:"stay_from",value:"Stay from",className:"text-[#475569] text-xs font-medium"}),e.jsx(f,{id:"stay_from",name:"stay_from",value:o.stay_from,onChange:n,type:"date",className:"date-inp block w-full",placeholder:"dd.mm.yyyy"}),e.jsx(i,{message:a.stay_from})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(u,{htmlFor:"stay_till",value:"Stay till",className:"text-[#475569] text-xs font-medium"}),e.jsx(f,{id:"stay_till",name:"stay_till",value:o.stay_till,onChange:n,type:"date",className:"date-inp block w-full",placeholder:"dd.mm.yyyy"}),e.jsx(i,{message:a.stay_till})]})]}),e.jsx(D,{}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsxs("div",{className:`space-y-1 ${c?"block":"hidden"}`,children:[e.jsx(u,{htmlFor:"salutation",value:"Salutation",className:"text-[#475569] text-xs font-medium"}),e.jsx(E,{id:"salutation",name:"salutation",value:o.salutation,onChange:n,className:"w-full block",options:[{value:"Mr",label:"Mr."},{value:"Mrs",label:"Mrs."},{value:"Ms",label:"Ms."}]}),e.jsx(i,{message:a.salutation})]}),e.jsxs("div",{className:`space-y-1 ${c?"block":"hidden"}`,children:[e.jsx(u,{htmlFor:"title",value:"Title",className:"text-[#475569] text-xs font-medium"}),e.jsx(f,{id:"title",name:"title",value:o.title,onChange:n,type:"text",className:"block w-full",placeholder:"e.g. Dr."}),e.jsx(i,{message:a.title})]}),e.jsxs("div",{className:`space-y-1 ${c?"block":"hidden"}`,children:[e.jsx(u,{htmlFor:"first_name",value:"First Name",className:"text-[#475569] text-xs font-medium"}),e.jsx(f,{id:"first_name",name:"first_name",value:o.first_name,onChange:n,type:"text",className:"block w-full",placeholder:"First name"}),e.jsx(i,{message:a.first_name})]}),e.jsxs("div",{className:`space-y-1 ${c?"block":"hidden"}`,children:[e.jsx(u,{htmlFor:"last_name",value:"Last Name",className:"text-[#475569] text-xs font-medium"}),e.jsx(f,{id:"last_name",name:"last_name",value:o.last_name,onChange:n,type:"text",className:"block w-full",placeholder:"Last name"}),e.jsx(i,{message:a.last_name})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(u,{htmlFor:"room_number",value:"Room Number",className:"text-[#475569] text-xs font-medium"}),e.jsx(f,{id:"room_number",name:"room_number",value:o.room_number,onChange:n,type:"text",className:"block w-full",placeholder:"Room #"}),e.jsx(i,{message:a.room_number})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"phone_number",value:"Mobile Phone Number (for Key finder only)",className:"text-[#475569] text-xs font-medium"}),e.jsx(f,{id:"phone_number",name:"phone_number",value:o.phone_number,onChange:n,type:"tel",className:"block w-full",placeholder:"+49 123 456789"}),e.jsx(i,{message:a.phone_number})]}),e.jsxs("div",{className:`space-y-1 ${c?"block":"hidden"}`,children:[e.jsx(u,{htmlFor:"email",value:"Email Address",className:"text-[#475569] text-xs font-medium"}),e.jsx(f,{id:"email",name:"email",value:o.email,onChange:n,type:"email",className:"block w-full",placeholder:"example@email.com"}),e.jsx(i,{message:a.email})]})]})]}),e.jsx(P,{message:y}),e.jsxs("div",{className:"flex items-center gap-2 justify-end flex-wrap",children:[p?e.jsx("p",{className:"text-sm",children:"Loading..."}):"",Object.keys(a).length>0&&e.jsx(i,{message:`${a?.general??"Fix the errors in the form."}`}),e.jsx(S,{onClick:()=>g(!0),children:"Cancel"}),e.jsx(F,{disabled:p,type:"submit",children:"Save"})]})]})}function C(){const{codeDetails:s,flash:g}=N().props,[_,a]=r.useState(!1),x=()=>{H.get(route("key.makeActive",{code:s.code}))},y=()=>{a(!0)};return _?e.jsx(I,{}):e.jsxs("div",{className:"space-y-4 text-center sm:px-7 py-4 text-base",children:[e.jsx("div",{className:"h-[120px] w-[120px] flex items-center justify-center mx-auto rounded-full border-light border",children:e.jsx("img",{src:"/images/key_icon.svg",alt:"Key",className:"h-16 w-16"})}),e.jsx("p",{children:"This key can serve as a key finder after your stay."}),e.jsxs("p",{children:["To do so you must enter your mobile number along with other details in next dialog so that a finder can"," ",e.jsx("span",{className:"font-bold",children:"contact you"}),"."]}),e.jsx("p",{children:"Would you like to use the key finder function?"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(F,{onClick:y,children:"Yes"}),e.jsx(S,{onClick:x,children:"No"})]})]})}function K(){const{selectedHotel:s=null,codeDetails:g}=N().props,{brandingFormData:_,setBrandingFormData:a}=r.useContext(L),[x,y]=r.useState(!1),{url:b}=N();r.useEffect(()=>{s&&a(h=>({...h,user_view:!0,heading:s.heading||"",primary_color:s.primary_color||"#000000",background_color:s.background_color||"#c1c1c1",text_color:s.text_color||"#1b1b1b",button_text_color:s.button_text_color||"#ffffff",logo_image:null,logo_image_url:s.logo_image?`/storage/${s.logo_image}`:null,banner_image:null,banner_image_url:s.banner_image?`/storage/${s.banner_image}`:null,key_finder_page_text:s.key_finder_page_text||"",page_text_color:s.page_text_color||"#000000",pages:s?.pages,buttons:(s?.buttons||[]).map(l=>({button_id:l.id??null,hotel_id:l.hotel_id??s.id,type:l.type||"",text:l.text||"",icon:l.icon||"",order:l.order??0,text_color:l.text_color||"#ffffff",background_color:l.background_color||"#84af83",url:l.url||"",phone:l.phone||"",wifi_name:l.wifi_name||"",wifi_password:l.wifi_password||"",page_id:l.page_id??null}))}))},[s,b]);const c=g?.key_assignment,k=g?.key_type?.name,p=c?.stay_till,m=p?new Date(p):null,o=new Date,v=m!==null&&m<o,n=g?.status,j=c?.phone_number?.trim();console.log("Data:",{keyTypeName:k,status:n,phoneNumber:j,stayTillRaw:p,isExpired:v});let d=w,t=!1;return k==="key_finder"&&(n==="inactive"?(d=C,t=!0,console.log("1")):j?m&&m>o?(d=w,console.log("3")):n==="active"&&j&&v&&(d=A,console.log("4")):(d=w,console.log("2"))),r.useEffect(()=>{t&&y(!0)},[t]),e.jsxs(e.Fragment,{children:[e.jsx(M,{title:_?.heading??"Hotel"}),e.jsx($,{realPhone:!0,defaultView:x,children:e.jsx(d,{})})]})}K.layout=s=>e.jsx(G,{children:s});export{K as default};
