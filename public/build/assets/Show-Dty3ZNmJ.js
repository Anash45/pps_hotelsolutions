import{r as o,j as e,b as N,I as d,T as x,a as n,D,S as E,d as w,P as S,e as T,f as H,h as L,H as M}from"./app-Dy2hwrlG.js";import{G as A}from"./GuestBox-7tu8Em8M.js";import{H as P}from"./HotelKeyFinder-CEw_f_HT.js";import{H as k}from"./HotelLanding-Cljt3mId.js";import{F as $}from"./FlashMessage-D5e26S5I.js";import{G as B}from"./GuestKeyLayout-DXnj5vbP.js";import{m as G}from"./mapHotelToBrandingFormData-CLw-jNZI.js";function I(){const[r,h]=o.useState(!1);if(r)return e.jsx(F,{});const{codeDetails:p}=N().props,[s,u]=o.useState({}),[y,b]=o.useState(""),[i,_]=o.useState(!0),[f,m]=o.useState(!1),[t,v]=o.useState({salutation:"",title:"",first_name:"",last_name:"",room_number:"",phone_number:"",email:"",stay_from:"",stay_till:"",gdpr_consent:i,code_id:p?.code??null}),l=c=>{const{name:a,value:j}=c.target;v(C=>({...C,[a]:j}))},g=async c=>{c.preventDefault(),u({}),b(""),m(!0);try{const a=await T.post(route("keyassignment.userStore"),t);a.data.success?(m(!1),console.log("✅ Saved:",a.data.message),b(a.data.message),setTimeout(()=>{window.location.reload()},2e3)):(m(!1),console.log("⚠️ Error:",a.data.message),u({general:[a.data.message]}))}catch(a){if(m(!1),a.response?.status===422){const j=a.response.data;console.log("⚠️ Validation failed:",j),u(j.errors||{general:[j.message]})}else console.error("Unexpected error:",a),u({general:["Something went wrong."]})}};return console.log(s),e.jsxs("form",{onSubmit:g,className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h2",{className:"text-lg text-[#201A20] font-semibold",children:"Register Key Finder"}),e.jsx("p",{className:"text-xs font-medium text-[#475569]",children:"Setup key finder"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{htmlFor:"stay_from",value:"Stay from",className:"text-[#475569] text-xs font-medium"}),e.jsx(x,{id:"stay_from",name:"stay_from",value:t.stay_from,onChange:l,type:"date",className:"date-inp block w-full",placeholder:"dd.mm.yyyy"}),e.jsx(n,{message:s.stay_from})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{htmlFor:"stay_till",value:"Stay till",className:"text-[#475569] text-xs font-medium"}),e.jsx(x,{id:"stay_till",name:"stay_till",value:t.stay_till,onChange:l,type:"date",className:"date-inp block w-full",placeholder:"dd.mm.yyyy"}),e.jsx(n,{message:s.stay_till})]})]}),e.jsx(D,{}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsxs("div",{className:`space-y-1 ${i?"block":"hidden"}`,children:[e.jsx(d,{htmlFor:"salutation",value:"Salutation",className:"text-[#475569] text-xs font-medium"}),e.jsx(E,{id:"salutation",name:"salutation",value:t.salutation,onChange:l,className:"w-full block",options:[{value:"Mr",label:"Mr."},{value:"Mrs",label:"Mrs."},{value:"Ms",label:"Ms."}]}),e.jsx(n,{message:s.salutation})]}),e.jsxs("div",{className:`space-y-1 ${i?"block":"hidden"}`,children:[e.jsx(d,{htmlFor:"title",value:"Title",className:"text-[#475569] text-xs font-medium"}),e.jsx(x,{id:"title",name:"title",value:t.title,onChange:l,type:"text",className:"block w-full",placeholder:"e.g. Dr."}),e.jsx(n,{message:s.title})]}),e.jsxs("div",{className:`space-y-1 ${i?"block":"hidden"}`,children:[e.jsx(d,{htmlFor:"first_name",value:"First Name",className:"text-[#475569] text-xs font-medium"}),e.jsx(x,{id:"first_name",name:"first_name",value:t.first_name,onChange:l,type:"text",className:"block w-full",placeholder:"First name"}),e.jsx(n,{message:s.first_name})]}),e.jsxs("div",{className:`space-y-1 ${i?"block":"hidden"}`,children:[e.jsx(d,{htmlFor:"last_name",value:"Last Name",className:"text-[#475569] text-xs font-medium"}),e.jsx(x,{id:"last_name",name:"last_name",value:t.last_name,onChange:l,type:"text",className:"block w-full",placeholder:"Last name"}),e.jsx(n,{message:s.last_name})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{htmlFor:"room_number",value:"Room Number",className:"text-[#475569] text-xs font-medium"}),e.jsx(x,{id:"room_number",name:"room_number",value:t.room_number,onChange:l,type:"text",className:"block w-full",placeholder:"Room #"}),e.jsx(n,{message:s.room_number})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"phone_number",value:"Mobile Phone Number (for Key finder only)",className:"text-[#475569] text-xs font-medium"}),e.jsx(x,{id:"phone_number",name:"phone_number",value:t.phone_number,onChange:l,type:"tel",className:"block w-full",placeholder:"+49 123 456789"}),e.jsx(n,{message:s.phone_number})]}),e.jsxs("div",{className:`space-y-1 ${i?"block":"hidden"}`,children:[e.jsx(d,{htmlFor:"email",value:"Email Address",className:"text-[#475569] text-xs font-medium"}),e.jsx(x,{id:"email",name:"email",value:t.email,onChange:l,type:"email",className:"block w-full",placeholder:"example@email.com"}),e.jsx(n,{message:s.email})]})]})]}),e.jsx($,{message:y}),e.jsxs("div",{className:"flex items-center gap-2 justify-end flex-wrap",children:[f?e.jsx("p",{className:"text-sm",children:"Loading..."}):"",Object.keys(s).length>0&&e.jsx(n,{message:`${s?.general??"Fix the errors in the form."}`}),e.jsx(w,{onClick:()=>h(!0),children:"Cancel"}),e.jsx(S,{disabled:f,type:"submit",children:"Save"})]})]})}function F(){const{codeDetails:r,flash:h}=N().props,[p,s]=o.useState(!1),u=()=>{H.get(route("key.makeActive",{code:r.code}))},y=()=>{s(!0)};return p?e.jsx(I,{}):e.jsxs("div",{className:"space-y-4 text-center sm:px-7 py-4 text-base",children:[e.jsx("div",{className:"h-[120px] w-[120px] flex items-center justify-center mx-auto rounded-full border-light border",children:e.jsx("img",{src:"/images/key_icon.svg",alt:"Key",className:"h-16 w-16"})}),e.jsx("p",{children:"This key can serve as a key finder after your stay."}),e.jsxs("p",{children:["To do so you must enter your mobile number along with other details in next dialog so that a finder can"," ",e.jsx("span",{className:"font-bold",children:"contact you"}),"."]}),e.jsx("p",{children:"Would you like to use the key finder function?"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(S,{onClick:y,children:"Yes"}),e.jsx(w,{onClick:u,children:"No"})]})]})}function K(){const{selectedHotel:r=null,codeDetails:h}=N().props,{brandingFormData:p,setBrandingFormData:s}=o.useContext(L),[u,y]=o.useState(!1),{url:b}=N();o.useEffect(()=>{r&&s(G(r,{user_view:!0}))},[r,b]);const i=h?.key_assignment,_=h?.key_type?.name,f=i?.stay_till,m=f?new Date(f):null,t=new Date,v=m!==null&&m<t,l=h?.status,g=i?.phone_number?.trim();console.log("Data:",{keyTypeName:_,status:l,phoneNumber:g,stayTillRaw:f,isExpired:v});let c=k,a=!1;return _==="key_finder"&&(l==="inactive"?(c=F,a=!0,console.log("1")):g?m&&m>t?(c=k,console.log("3")):l==="active"&&g&&v&&(c=P,console.log("4")):(c=k,console.log("2"))),o.useEffect(()=>{a&&y(!0)},[a]),e.jsxs(e.Fragment,{children:[e.jsx(M,{title:p?.heading??"Hotel"}),e.jsx(A,{realPhone:!0,defaultView:u,children:e.jsx(c,{})})]})}K.layout=r=>e.jsx(B,{children:r});export{K as default};
