import{h as A,r as i,j as e,b as H,c as S,I as j,T as _,a as h,D as B,S as I,e as E,P as L,i as R,k as $,l as K,H as P}from"./app-BHMje5Ea.js";import{G}from"./GuestBox-Cav9lmG1.js";import{H as T}from"./HotelKeyFinder-D3gLVzcc.js";import{H as D}from"./HotelLanding-CBMTv6XA.js";import{F as U}from"./FlashMessage-CFIZCdQa.js";import{G as V}from"./GuestKeyLayout-jr82PgSk.js";import{m as q}from"./mapHotelToBrandingFormData-BFWpowZZ.js";function a({text:c}){const s=A()?.lang||null,[l,u]=i.useState(c),[w,v]=i.useState(!1),x=i.useRef(c),N=i.useRef({});i.useEffect(()=>{x.current=c,s||u(c)},[c,s]);const y=async n=>{try{return(await(await fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=auto&tl=en&dt=t&q=${encodeURIComponent(n)}`)).json())[2]||"en"}catch{return"en"}},p=async(n,t,f)=>{const m=`${t}->${f}:${n}`;if(N.current[m])return N.current[m];try{const g=(await(await fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=${t}&tl=${f}&dt=t&q=${encodeURIComponent(n)}`)).json())[0][0][0];return N.current[m]=g,g}catch{return n}},o=async(n,t)=>{if(!/<[^>]+>/.test(n)){const g=await y(n);return g===t?n:await p(n,g,t)}const m=/>([^<]+)</g,r=[...n.matchAll(m)];let d=n;for(let g of r){const k=g[1].trim();if(!k)continue;const C=await y(k);let F=k;C!==t&&(F=await p(k,C,t)),d=d.replace(k,F)}return d};return i.useEffect(()=>{if(!s)return;(async()=>{v(!0);const t=await o(x.current,s);u(t),v(!1)})()},[s,c]),e.jsx("span",{style:{whiteSpace:"pre-wrap"},dangerouslySetInnerHTML:{__html:w?"...":l}})}function z(){const[c,b]=i.useState(!1);if(H("Components.userSelfEdit"),c)return e.jsx(M,{});const{codeDetails:s}=S().props,[l,u]=i.useState({}),[w,v]=i.useState(""),[x,N]=i.useState(!0),[y,p]=i.useState(!1),[o,n]=i.useState({salutation:"",title:"",first_name:"",last_name:"",room_number:"",phone_number:"",email:"",stay_from:"",stay_till:"",gdpr_consent:x,code_id:s?.code??null}),t=m=>{const{name:r,value:d}=m.target;n(g=>({...g,[r]:d}))},f=async m=>{m.preventDefault(),u({}),v(""),p(!0);try{const r=await R.post(route("keyassignment.userStore"),o);r.data.success?(p(!1),v(r.data.message),setTimeout(()=>window.location.reload(),2e3)):(p(!1),u({general:[r.data.message]}))}catch(r){if(p(!1),r.response?.status===422){const d=r.response.data;u(d.errors||{general:[d.message]})}else u({general:[e.jsx(a,{text:"Something went wrong."})]})}};return e.jsxs("form",{onSubmit:f,className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h2",{className:"text-lg text-[#201A20] font-semibold",children:e.jsx(a,{text:"Register Key Finder"})}),e.jsx("p",{className:"text-xs font-medium text-[#475569]",children:e.jsx(a,{text:"Setup key finder"})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(j,{htmlFor:"stay_from",value:e.jsx(a,{text:"Stay from"}),className:"text-[#475569] text-xs font-medium"}),e.jsx(_,{id:"stay_from",name:"stay_from",value:o.stay_from,onChange:t,type:"date",className:"date-inp block w-full",placeholder:"dd.mm.yyyy"}),e.jsx(h,{message:l.stay_from})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(j,{htmlFor:"stay_till",value:e.jsx(a,{text:"Stay till"}),className:"text-[#475569] text-xs font-medium"}),e.jsx(_,{id:"stay_till",name:"stay_till",value:o.stay_till,onChange:t,type:"date",className:"date-inp block w-full",placeholder:"dd.mm.yyyy"}),e.jsx(h,{message:l.stay_till})]})]}),e.jsx(B,{}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[x&&e.jsxs("div",{className:"space-y-1",children:[e.jsx(j,{htmlFor:"salutation",value:e.jsx(a,{text:"Salutation"}),className:"text-[#475569] text-xs font-medium"}),e.jsx(I,{id:"salutation",name:"salutation",value:o.salutation,onChange:t,className:"w-full block",options:[{value:"Mr",label:e.jsx(a,{text:"Mr."})},{value:"Mrs",label:e.jsx(a,{text:"Mrs."})},{value:"Ms",label:e.jsx(a,{text:"Ms."})}]}),e.jsx(h,{message:l.salutation})]}),x&&e.jsxs("div",{className:"space-y-1",children:[e.jsx(j,{htmlFor:"title",value:e.jsx(a,{text:"Title"}),className:"text-[#475569] text-xs font-medium"}),e.jsx(_,{id:"title",name:"title",value:o.title,onChange:t,type:"text",className:"block w-full",placeholder:"e.g. Dr."}),e.jsx(h,{message:l.title})]}),x&&e.jsxs("div",{className:"space-y-1",children:[e.jsx(j,{htmlFor:"first_name",value:e.jsx(a,{text:"First Name"}),className:"text-[#475569] text-xs font-medium"}),e.jsx(_,{id:"first_name",name:"first_name",value:o.first_name,onChange:t,type:"text",className:"block w-full",placeholder:"e.g. John"}),e.jsx(h,{message:l.first_name})]}),x&&e.jsxs("div",{className:"space-y-1",children:[e.jsx(j,{htmlFor:"last_name",value:e.jsx(a,{text:"Last Name"}),className:"text-[#475569] text-xs font-medium"}),e.jsx(_,{id:"last_name",name:"last_name",value:o.last_name,onChange:t,type:"text",className:"block w-full",placeholder:"e.g. Doe"}),e.jsx(h,{message:l.last_name})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(j,{htmlFor:"room_number",value:e.jsx(a,{text:"Room Number"}),className:"text-[#475569] text-xs font-medium"}),e.jsx(_,{id:"room_number",name:"room_number",value:o.room_number,onChange:t,type:"text",className:"block w-full",placeholder:"e.g. 321"}),e.jsx(h,{message:l.room_number})]}),e.jsxs("div",{children:[e.jsx(j,{htmlFor:"phone_number",value:e.jsx(a,{text:"Mobile Phone Number (for Key Finder only)"}),className:"text-[#475569] text-xs font-medium"}),e.jsx(_,{id:"phone_number",name:"phone_number",value:o.phone_number,onChange:t,type:"tel",className:"block w-full",placeholder:"e.g. +49 123 456789"}),e.jsx(h,{message:l.phone_number})]}),x&&e.jsxs("div",{className:"space-y-1",children:[e.jsx(j,{htmlFor:"email",value:e.jsx(a,{text:"Email Address"}),className:"text-[#475569] text-xs font-medium"}),e.jsx(_,{id:"email",name:"email",value:o.email,onChange:t,type:"email",className:"block w-full",placeholder:"e.g. example@xyz.com"}),e.jsx(h,{message:l.email})]})]})]}),e.jsx(U,{message:w}),e.jsxs("div",{className:"flex items-center gap-2 justify-end flex-wrap",children:[e.jsxs("div",{className:"flex gap-2",children:[y&&e.jsx("p",{className:"text-sm",children:e.jsx(a,{text:"Loading..."})}),Object.keys(l).length>0&&e.jsx(h,{message:l?.general??e.jsx(a,{text:"Fix the errors in the form."})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(E,{onClick:()=>b(!0),children:e.jsx(a,{text:"Cancel"})}),e.jsx(L,{disabled:y,type:"submit",children:e.jsx(a,{text:"Save"})})]})]})]})}function M(){const{codeDetails:c,flash:b}=S().props,[s,l]=i.useState(!1);H("Components.AskDetails");const u=()=>{$.get(route("key.makeActive",{code:c.code}))},w=()=>{l(!0)};return s?e.jsx(z,{}):e.jsxs("div",{className:"space-y-4 text-center sm:px-7 py-4 text-base",children:[e.jsx("div",{className:"h-[120px] w-[120px] flex items-center justify-center mx-auto rounded-full border-light border",children:e.jsx("img",{src:"/images/key_icon.svg",alt:"Key",className:"h-16 w-16"})}),e.jsx("p",{children:"This key can serve as a key finder after your stay."}),e.jsxs("p",{children:["To do so, you must enter your mobile number along with other details in the next dialog so that a finder can ",e.jsx("span",{class:"font-bold",children:"contact you"}),"."]}),e.jsx("p",{children:"Would you like to use the key finder function?"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(L,{onClick:w,children:"Yes"}),e.jsx(E,{onClick:u,children:"No"})]})]})}function Y(){const{selectedHotel:c=null,codeDetails:b}=S().props,{brandingFormData:s,setBrandingFormData:l,loadingButton:u}=i.useContext(K),[w,v]=i.useState(!1),{url:x}=S();i.useEffect(()=>{c&&l(q(c,{user_view:!0}))},[c,x]);const N=b?.key_assignment,y=b?.key_type?.name,p=N?.stay_till,o=p?new Date(p):null,n=new Date,t=o!==null&&o<n,f=b?.status,m=N?.phone_number?.trim();console.log("Data:",{keyTypeName:y,status:f,phoneNumber:m,stayTillRaw:p,isExpired:t});let r=D,d=!1;return y==="key_finder"&&(f==="inactive"?(r=M,d=!0,console.log("1")):o&&o>n||!m?(r=D,console.log("3")):f==="active"&&m&&t&&(r=T,console.log("4"))),i.useEffect(()=>{d&&v(!0)},[d]),e.jsxs(e.Fragment,{children:[e.jsxs(P,{children:[e.jsx("title",{children:s?.heading??"Hotel"}),e.jsx("link",{rel:"icon",type:"image/png",href:s?.logo_image_url??"/images/building-placeholder.webp"}),e.jsx("meta",{property:"og:title",content:s?.heading??"Hotel"}),e.jsx("meta",{property:"og:description",content:s?.meta_description??s?.description??"Book your perfect stay with us!"}),e.jsx("meta",{property:"og:image",content:s?.logo_image_url??"/images/building-placeholder.webp"}),e.jsx("meta",{property:"og:type",content:"website"}),e.jsx("meta",{property:"og:url",content:typeof window<"u"?window.location.href:""}),e.jsx("meta",{name:"twitter:card",content:"summary_large_image"}),e.jsx("meta",{name:"twitter:title",content:s?.heading??"Hotel"}),e.jsx("meta",{name:"twitter:description",content:s?.meta_description??s?.description??"Book your perfect stay with us!"}),e.jsx("meta",{name:"twitter:image",content:s?.logo_image_url??"/images/building-placeholder.webp"})]}),e.jsx(G,{realPhone:!0,defaultView:w,showNextBox:r===T,children:e.jsx(r,{})}),u&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-70 z-50",children:e.jsx("div",{className:"loader border-t-transparent border-4 border-[#b6ffb5] rounded-full w-10 h-10 animate-spin"})})]})}Y.layout=c=>e.jsx(e.Fragment,{children:e.jsx(V,{children:c})});export{Y as default};
